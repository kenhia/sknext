# CLI Contract: Task Status Viewer

**Phase**: 1 - Design  
**Date**: 2026-02-05  
**Tool**: typer-based CLI interface

## Command Overview

```bash
sknext [OPTIONS] [FILE_PATH]
```

**Purpose**: Display uncompleted tasks from a speckit tasks.md file with flexible viewing options.

---

## Arguments

### `FILE_PATH` (Optional)

**Type**: `str` (file path)  
**Required**: No  
**Default**: Auto-discover latest from `specs/###-*/tasks.md`

**Description**: Path to the tasks.md file to parse. If not provided, the tool automatically discovers the latest spec directory by finding the highest-numbered directory under `specs/` and looking for `tasks.md` within it.

**Examples**:
```bash
# Auto-discover latest
sknext

# Explicit path
sknext specs/001-task-status-viewer/tasks.md

# Absolute path
sknext /home/user/project/specs/042-feature/tasks.md
```

---

## Options

### Display Mode Flags (Mutually Exclusive)

Only one of these flags can be used at a time:

#### `--phases-only`

**Type**: `bool` (flag)  
**Default**: `False`  
**Description**: Show only phase headings with uncompleted work (no sections or tasks)

**Example**:
```bash
sknext --phases-only
```

**Output**:
```
## Phase 1: Setup
## Phase 2: Foundation (US1)
## Phase 4: Feature Implementation
```

---

#### `--structure`

**Type**: `bool` (flag)  
**Default**: `False`  
**Description**: Show phases and sections with uncompleted work (no individual tasks)

**Example**:
```bash
sknext --structure
```

**Output**:
```
## Phase 1: Setup
  ### Setup (Shared Infrastructure)
  ### Configuration

## Phase 2: Foundation (US1)
  ### Core Models
  ### Database Schema
```

---

#### `--tasks-only`

**Type**: `bool` (flag)  
**Default**: `False`  
**Description**: Show only task lines without any heading context

**Example**:
```bash
sknext --tasks-only -n 5
```

**Output**:
```
- [ ] T001 Create project structure per implementation plan
- [ ] T002 Initialize Python project with uv
- [ ] T003 [P] Configure linting and formatting tools
- [ ] T004 Setup pytest configuration
- [ ] T005 Create base data models
```

---

#### `--all`

**Type**: `bool` (flag)  
**Default**: `False`  
**Description**: Show all remaining tasks with full hierarchical context (no limit)

**Example**:
```bash
sknext --all
```

---

#### `--all-phases`

**Type**: `bool` (flag)  
**Default**: `False`  
**Description**: Show all phases with uncompleted work, followed by N tasks (combines phase overview + task detail)

**Example**:
```bash
sknext --all-phases -n 10
```

**Output**:
```
=== Phases with Remaining Work ===
## Phase 1: Setup
## Phase 2: Foundation (US1)
## Phase 4: Feature Implementation

=== Next 10 Tasks ===
## Phase 1: Setup
  ### Setup (Shared Infrastructure)
    - [ ] T001 Create project structure per implementation plan
    ...
```

---

### Count Options

#### `-n, --count`

**Type**: `int`  
**Required**: No  
**Default**: `10`  
**Valid Range**: `0-999999` (0 triggers humorous "VERY large values of zero" message)  
**Description**: Number of uncompleted tasks to display (ignored by `--phases-only` and `--structure`)

**Examples**:
```bash
# Show 25 tasks
sknext -n 25

# Show 3 tasks
sknext --count 3

# Show 0 tasks (special case: shows 1 with humorous message)
sknext -n 0
```

---

### Help & Version

#### `--help`

**Type**: `bool` (flag)  
**Description**: Show help message and exit (auto-generated by typer)

**Example**:
```bash
sknext --help
```

---

#### `--version`

**Type**: `bool` (flag)  
**Description**: Show version and exit

**Example**:
```bash
sknext --version
```

**Output**:
```
sknext version 1.0.0
```

---

## Exit Codes

| Code | Constant | Meaning |
|------|----------|---------|
| 0 | `EXIT_SUCCESS` | Successful execution |
| 1 | `EXIT_FILE_NOT_FOUND` | File not found or unreadable |
| 2 | `EXIT_PARSE_ERROR` | Malformed file structure |
| 3 | `EXIT_INVALID_ARGS` | Invalid command-line arguments |

---

## Error Messages

### File Not Found

```
Error: tasks.md file not found

Attempted path: specs/001-task-status-viewer/tasks.md

Suggestions:
  - Check that the file exists
  - Provide explicit path: sknext path/to/tasks.md
  - Verify you're running from repository root
```

**Exit Code**: 1

---

### Parse Error

```
Error: Malformed task syntax at line 67

Line 67: - [] T042 Missing space in checkbox

Expected format: - [ ] TXXX [P] [USX] Description

Task checkbox must have single space: '[ ]' or '[x]'
```

**Exit Code**: 2

---

### No Tasks Found

```
âœ“ All tasks complete!

File: specs/001-task-status-viewer/tasks.md
Total tasks: 42 (all completed)
```

**Exit Code**: 0 (not an error)

---

### Conflicting Flags

```
Error: Cannot combine --phases-only with --structure

Use only one display mode flag at a time.
Run `sknext --help` for usage information.
```

**Exit Code**: 3

---

## Output Format

### Default View (Rich Formatted)

```
## Phase 1: Setup
  ### Setup (Shared Infrastructure)
    - [ ] T001 Create project structure per implementation plan
    - [ ] T002 Initialize Python project with uv dependencies

## Phase 2: Foundation (US1)
  ### Core Models
    - [ ] T015 [P] [US1] Create Task dataclass with validation
    - [ ] T016 [US1] Create Section dataclass
    
Showing 10 of 47 remaining tasks
```

**Formatting**:
- Phases: Bold blue `##` prefix
- Sections: Green `###` prefix, indented 2 spaces
- Tasks: White text, indented 4 spaces
- Priority `[P]`: Yellow highlight
- Story tags `[US1]`: Cyan color
- Summary: Gray italic at bottom

---

## Example Usage Scenarios

### Quick Status Check (Default)
```bash
cd /home/user/project
sknext
# Shows next 10 tasks with context
```

### Sprint Planning (Show 50 tasks)
```bash
sknext -n 50
```

### High-Level Overview (Phases only)
```bash
sknext --phases-only
```

### Copy Tasks to Status Report (No headings)
```bash
sknext --tasks-only -n 20 > status.txt
```

### Complete Task Inventory
```bash
sknext --all > full-status.md
```

### Combined Strategic + Tactical View
```bash
sknext --all-phases -n 15
```

---

## Type Signature (Python)

```python
import typer
from pathlib import Path
from typing import Optional

app = typer.Typer()

@app.command()
def main(
    file_path: Optional[Path] = typer.Argument(
        None,
        help="Path to tasks.md file (auto-discovers latest if not provided)"
    ),
    count: int = typer.Option(
        10,
        "-n", "--count",
        help="Number of tasks to display",
        min=0
    ),
    phases_only: bool = typer.Option(
        False,
        "--phases-only",
        help="Show only phases with uncompleted work"
    ),
    structure: bool = typer.Option(
        False,
        "--structure",
        help="Show phases and sections (no tasks)"
    ),
    tasks_only: bool = typer.Option(
        False,
        "--tasks-only",
        help="Show only task lines (no headings)"
    ),
    all_tasks: bool = typer.Option(
        False,
        "--all",
        help="Show all remaining tasks"
    ),
    all_phases: bool = typer.Option(
        False,
        "--all-phases",
        help="Show all phases plus N tasks"
    ),
) -> None:
    """Display uncompleted tasks from a speckit tasks.md file."""
    ...
```
